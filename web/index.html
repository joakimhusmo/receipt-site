<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Письмо к лесу и солнцу</title>

  <!-- Google font for UI chrome -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- Your styles (now contains ALL CSS including @font-face) -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Письмо к лесу и солнцу</h1>

    <label for="msg">Что бы ты хотел сказать?</label>
    <input id="msg" type="text" placeholder="Type here…" />

    <button id="btnCustom">Толкни меня!</button>

    <div id="statusEl" aria-live="polite"></div>
  </div>

  <script>
// ---------- Tunables ----------
// These are the only numbers you should tweak for size/spacing.
// 80mm paper is ~576 dots wide on most Epson/TM printers.
const W = 544;          // receipt width in dots (80mm)
const PADDING = 28;     // horizontal padding in pixels/dots
let FONT_SIZE = 120;     // font size in pixels (preview + print)
let LINE = 90;          // line height in pixels

// --- Render wrapped, centered text to a canvas using NewFont ---
async function textToPngDataURL(text) {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    ctx.font = `${FONT_SIZE}px NewFont`;
    ctx.textBaseline = "top";

    // Calculate maximum width for text, considering padding
    const maxWidth = W - 2 * PADDING;

    // Break text into words
    const words = text.split(" ");
    let lines = [];
    let currentLine = words[0];

    for (let i = 1; i < words.length; i++) {
        const word = words[i];
        const width = ctx.measureText(currentLine + " " + word).width;
        if (width < maxWidth) {
            currentLine += " " + word;
        } else {
            lines.push(currentLine);
            currentLine = word;
        }
    }
    lines.push(currentLine);

    // Set canvas size based on lines
    canvas.width = W;
    canvas.height = lines.length * LINE;

    // Fill background white
    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Set font again after resizing
    ctx.font = `${FONT_SIZE}px NewFont`;
    ctx.fillStyle = "#000";
    ctx.textBaseline = "top";

    // Draw each line centered within (W - 2*PADDING)
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const lineWidth = ctx.measureText(line).width;
        const x = PADDING + (maxWidth - lineWidth) / 2;
        const y = i * LINE;
        ctx.fillText(line, x, y);
    }

    return canvas.toDataURL("image/png");
}
</script>
</body>
</html>